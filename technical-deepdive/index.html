<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Technical architecture and implementation details of Gigaflow"><meta name=author content="Annus Zulfiqar"><link href=../benchmarks/ rel=prev><link href=../contributing/ rel=next><link rel=icon href=../assets/gf-icon-transparent-smaller.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.11"><title>Technical Deepdive - Gigaflow vSwitch (GvS)</title><link rel=stylesheet href=../assets/stylesheets/main.4af4bdda.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../styles/custom.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><!-- Determine title --><!--  --><!--  --><!--  --><!-- The image needs to have an absolute URL --><!--  --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Gigaflow vSwitch (GvS)"><meta property=og:description content="A Pipeline-Aware Sub-Traversal Cache for Modern SmartNICs"><meta property=og:url content=None><meta property=og:image content=https://gigaflow-vswitch.github.io/assets/gf-icon-small.png><meta property=og:image:type content=image/png><!-- <meta property="og:image:width" content="1080" />
  <meta property="og:image:height" content="568" /> --><!-- google-site-verification meta-tag --><meta name=google-site-verification content=-Rj8YMCn9uu5IwOFdC-WfAzXp4ZOMJtYKxU40ZgcJIU><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/tw-elements/dist/css/tw-elements.min.css><!-- <script src="https://cdn.tailwindcss.com/3.3.0"></script>
  <script src="https://cdn.tailwindcss.com?plugins=typography,aspect-ratio,line-clamp"></script> --><script>
  tailwind.config = {
    darkMode: "class",
    theme: {
      fontFamily: {
        sans: ["Roboto", "sans-serif"],
        body: ["Roboto", "sans-serif"],
        mono: ["ui-monospace", "monospace"],
      },
    },
    corePlugins: {
      preflight: false,
    },
  };
</script><script src=https://cdn.jsdelivr.net/npm/tw-elements/dist/js/tw-elements.umd.min.js></script><!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> --><script src=https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.2.0/chart.js integrity="sha512-opXrgVcTHsEVdBUZqTPlW9S8+99hNbaHmXtAdXXc61OUU6gOII5ku/PzZFqexHXc3hnK8IrJKHo+T7O4GRIJcw==" crossorigin=anonymous></script><!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.3.3/chart.js" integrity="sha512-F4BEJjzO7gmh8s7E9L63CdmC2NPdU8jBLJanZDJcSQC+t2vA+fELwQLRHzqsOlgHFD5FCCo/EPWvNxmcV4JjUw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> --><!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.js" integrity="sha512-7DgGWBKHddtgZ9Cgu8aGfJXvgcVv4SWSESomRtghob4k4orCBUTSRQ4s5SaC2Rz+OptMqNk0aHHsaUBk6fzIXw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> --><!-- <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script> --><!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js" integrity="sha512-ZwR1/gSZM3ai6vCdI+LVF1zSq/5HznD3ZSTk7kajkaj4D292NLuduDCO1c/NT8Id+jE58KYLKT7hXnbtryGmMg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> --><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/prism.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/components/prism-python.min.js integrity="sha512-3qtI9+9JXi658yli19POddU1RouYtkTEhTHo6X5ilOvMiDfNvo6GIS6k2Ukrsx8MyaKSXeVrnIWeyH8G5EOyIQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/themes/prism-okaidia.min.css integrity="sha512-5HvW0a7ihK3ro2KhwEksDHXgIezsTeZybZDIn8d8Y015Ny+t7QWSIjnlCTjFzlK7Klb604HLGjsNqU/i5mJLjQ==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/plugins/line-numbers/prism-line-numbers.min.css integrity="sha512-3/cdM9qaJ5lBlzRKqwhMw+ZcNCVonz66BO6HgJudG/P1azm9wFrru31SsBa4T4Ew1AOH8HfDXSWS6emWwPl42A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/plugins/line-numbers/prism-line-numbers.min.js integrity="sha512-QTYXYEniHb1m0ZKtSyfpmw40uH9vPfV07vxsv/plIRMEiON4yOp2qoZiv/FTqFIOym4bdQ4+p9RtHaCMC0ApRw==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>document.body.className += ' ' + 'line-numbers';</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin=anonymous referrerpolicy=no-referrer><!-- Extra stylesheets --><!--  <link
    rel="stylesheet"
    href="../assets/stylesheets/overrides.css"
  />--><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-MZCBZV7YYN"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MZCBZV7YYN');
</script><!-- Default Statcounter code for sieve
https://sievecache.com --><script type=text/javascript>
  var sc_project=12950146; 
  var sc_invisible=1; 
  var sc_security="2959f7f0"; 
  </script><script type=text/javascript src=https://www.statcounter.com/counter/counter.js async></script><noscript><div class=statcounter><a title="Web Analytics" href=https://statcounter.com/ target=_blank><img class=statcounter src=https://c.statcounter.com/12950146/0/2959f7f0/1/ alt="Web Analytics" referrerpolicy=no-referrer-when-downgrade></a></div></noscript><!-- End of Statcounter Code --><script src=js/script.js defer></script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=custom> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#technical-deepdive class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Gigaflow vSwitch (GvS)" class="md-header__button md-logo" aria-label="Gigaflow vSwitch (GvS)" data-md-component=logo> <img src=../assets/gf-icon-transparent-smaller.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Gigaflow vSwitch (GvS) </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Technical Deepdive </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=custom aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=custom aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../getting-started/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../installation/ class=md-tabs__link> Installation </a> </li> <li class=md-tabs__item> <a href=../usage/ class=md-tabs__link> Usage Guide </a> </li> <li class=md-tabs__item> <a href=../benchmarks/ class=md-tabs__link> Benchmarks </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Technical Details </a> </li> <li class=md-tabs__item> <a href=../contributing/ class=md-tabs__link> Contributing </a> </li> <li class=md-tabs__item> <a href=../publications/ class=md-tabs__link> References </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Gigaflow vSwitch (GvS)" class="md-nav__button md-logo" aria-label="Gigaflow vSwitch (GvS)" data-md-component=logo> <img src=../assets/gf-icon-transparent-smaller.png alt=logo> </a> Gigaflow vSwitch (GvS) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../usage/ class=md-nav__link> <span class=md-ellipsis> Usage Guide </span> </a> </li> <li class=md-nav__item> <a href=../benchmarks/ class=md-nav__link> <span class=md-ellipsis> Benchmarks </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Technical Details </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Technical Details </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#gigaflow-architecture class=md-nav__link> <span class=md-ellipsis> Gigaflow Architecture </span> </a> </li> <li class=md-nav__item> <a href=#pipeline-aware-locality class=md-nav__link> <span class=md-ellipsis> Pipeline-Aware Locality </span> </a> <nav class=md-nav aria-label="Pipeline-Aware Locality"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#disjointedness-property class=md-nav__link> <span class=md-ellipsis> Disjointedness Property </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mapping-traversals-to-gigaflow class=md-nav__link> <span class=md-ellipsis> Mapping Traversals to Gigaflow </span> </a> <nav class=md-nav aria-label="Mapping Traversals to Gigaflow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#traversal-processing class=md-nav__link> <span class=md-ellipsis> Traversal Processing </span> </a> </li> <li class=md-nav__item> <a href=#exploring-sub-traversals class=md-nav__link> <span class=md-ellipsis> Exploring Sub-Traversals </span> </a> </li> <li class=md-nav__item> <a href=#evaluating-a-sub-traversal class=md-nav__link> <span class=md-ellipsis> Evaluating a Sub-Traversal </span> </a> </li> <li class=md-nav__item> <a href=#putting-it-all-together class=md-nav__link> <span class=md-ellipsis> Putting It All Together </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../publications/ class=md-nav__link> <span class=md-ellipsis> References </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=technical-deepdive>Technical Deepdive</h1> <p>This document describes the technical architecture and implementation details of Gigaflow.</p> <h2 id=gigaflow-architecture>Gigaflow Architecture</h2> <p>Gigaflow is built as a caching sub-system in the Open vSwitch.</p> <!-- <figure markdown="span">
  ![Image title](assets/gigaflow-transparent.png){ width="500" }
  <figcaption>Figure 1: Gigaflow cache in the Open vSwitch (OVS)</figcaption>
</figure> --> <figure id=gigaflow-figure> <img src=/assets/gigaflow-light.png class=only-light width=500> <img src=/assets/gigaflow-dark.png class=only-dark width=500> <figcaption>Gigaflow cache in the Open vSwitch (OVS)</figcaption> </figure> <ul> <li>The input packet that misses the cache is sent to the userspace where its <code>flow</code> is extracted (header field set).</li> <li>The flow passes through the vSwitch pipeline and its traversal is collected.</li> <li>Then, the travesal mapper, based on disjointedness, captures pipeline-aware locality from this traversal and suggests suitable sub-traversals to be cached.</li> <li>Finally, Longest Traversal Matching (LTM) cache entries are generated and installed into the Gigaflow table.</li> </ul> <h2 id=pipeline-aware-locality>Pipeline-Aware Locality</h2> <p>The following figure shows an example of how pipeline-aware locality captures unseen traversals by caching shared sub-traversals. We <em>smartly</em> partition the traversal and determine suitable sub-traversals that have a high likelihood of being reused in the future by other flows.</p> <figure id=gigaflow-figure> <img src=/assets/gigaflow-example.gif width=900> <figcaption>An example of Gigaflow cache in action with three packets</figcaption> </figure> <h3 id=disjointedness-property>Disjointedness Property</h3> <p>Capturing pipeline-Aware locality is expensive (<a href=https://dl.acm.org/doi/10.1145/3676641.3716000>see the paper</a>) but we observe the following: disjoint sub-traversals maximize the cross-product rule space in Gigaflow tables. We implement a dynamic program to find disjoint sub-traversals in a given traversal and this algorithm processes the traversal of each cache miss without looking at how previous cache entries were generated.</p> <figure id=disjointedness-figure> <img src=/assets/disjointedness-example.gif width=900> <figcaption>Gigaflow captures pipeline-aware locality by capitalizing on field-level disjointedness in traversals</figcaption> </figure> <h2 id=mapping-traversals-to-gigaflow>Mapping Traversals to Gigaflow</h2> <h3 id=traversal-processing>Traversal Processing</h3> <p>The <a href=https://github.com/gigaflow-vswitch/gvs/blob/asplos-25/lib/mapper.c#L1356>map_traversal_to_gigaflow</a> function is responsible for mapping traversals to Gigaflow tables. It performs the following steps:</p> <ol> <li><strong>Cleanup</strong>: Cleans up mapping context before starting the mapping process.</li> <li><strong>Find Available Tables</strong>: Determines available Gigaflow tables with sufficient space for mapping.</li> <li><strong>Disjointedness Exploration</strong>: Implements the dynamic program to explore disjointedness across sub-traversals.</li> <li><strong>Compose and Map Wildcards</strong>: Composes and maps the wildcards as cache entries to the Gigaflow tables.</li> </ol> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>lib/dpif-netdev.c</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1356</span>
<span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span>
<span class=normal>1362</span>
<span class=normal>1363</span>
<span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span>
<span class=normal>1390</span>
<span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span>
<span class=normal>1399</span>
<span class=normal>1400</span>
<span class=normal>1401</span>
<span class=normal>1402</span>
<span class=normal>1403</span>
<span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kt>void</span>
<span class=nf>map_traversal_to_gigaflow</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>gigaflow_xlate_context</span><span class=w> </span><span class=o>*</span><span class=n>gf_xlate_ctx</span><span class=p>,</span>
<span class=w>                          </span><span class=k>struct</span><span class=w> </span><span class=nc>gigaflow_mapping_context</span><span class=w> </span><span class=o>*</span><span class=n>gf_map_ctx</span><span class=p>,</span>
<span class=w>                          </span><span class=k>struct</span><span class=w> </span><span class=nc>gigaflow_perf_stats</span><span class=w> </span><span class=o>*</span><span class=n>gf_stats</span><span class=p>,</span>
<span class=w>                          </span><span class=k>struct</span><span class=w> </span><span class=nc>pmd_perf_stats</span><span class=w> </span><span class=o>*</span><span class=n>stats</span><span class=p>)</span>
<span class=p>{</span>

<span class=w>    </span><span class=cm>/* no need to map if there was an error in translation </span>
<span class=cm>       this happens for recursion too deep during resubmissions */</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>gf_xlate_ctx</span><span class=o>-&gt;</span><span class=n>xlate_error</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>XLATE_OK</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>gf_map_ctx</span><span class=o>-&gt;</span><span class=n>map_out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>get_empty_mapper_out</span><span class=p>();</span>
<span class=w>        </span><span class=n>gf_map_ctx</span><span class=o>-&gt;</span><span class=n>mapped_cnt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>        </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* cleanup contexts before we start mapping </span>
<span class=cm>       THIS MUST BE THE FIRST STEP WHEN WE START MAPPING */</span>
<span class=w>    </span><span class=n>cleanup_before_mapping</span><span class=p>(</span><span class=n>gf_xlate_ctx</span><span class=p>,</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* 1. optimization passes to reduce the number of tables </span>
<span class=cm>          to consider before calling path maximization DP</span>
<span class=cm>        a. decoupling points in traversal?</span>
<span class=cm>        b. header space locality opportunity?</span>
<span class=cm>        c. explore vs exploit? */</span>

<span class=w>    </span><span class=cm>/* generate bit wildcards and determine available tables for mapping */</span>
<span class=w>    </span><span class=n>generate_bit_wildcards</span><span class=p>(</span><span class=n>gf_xlate_ctx</span><span class=p>,</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=p>);</span>
<span class=w>    </span><span class=n>find_available_tables_for_mapping</span><span class=p>(</span><span class=n>gf_map_ctx</span><span class=p>,</span><span class=w> </span><span class=n>gf_stats</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* 2. find and assign a traversal mapping to Gigaflow tables </span>
<span class=cm>       by maximizing added paths, coupling and other objectives */</span>
<span class=w>    </span><span class=kt>uint64_t</span><span class=w> </span><span class=n>optimizer_cycles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cycles_counter_update</span><span class=p>(</span><span class=n>stats</span><span class=p>);</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>mapper_out</span><span class=w> </span><span class=o>*</span><span class=n>opt_map_out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>maximize_optimality</span><span class=p>(</span><span class=n>gf_xlate_ctx</span><span class=p>,</span><span class=w> </span>
<span class=w>                                                         </span><span class=n>gf_map_ctx</span><span class=p>);</span>
<span class=w>    </span><span class=n>optimizer_cycles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cycles_counter_update</span><span class=p>(</span><span class=n>stats</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>optimizer_cycles</span><span class=p>;</span>
<span class=w>    </span><span class=n>gf_perf_update_counter</span><span class=p>(</span><span class=n>gf_stats</span><span class=p>,</span><span class=w> </span><span class=n>GF_STAT_OPTIMIZER_CYCLES</span><span class=p>,</span><span class=w> </span><span class=n>optimizer_cycles</span><span class=p>);</span>
<span class=w>    </span><span class=n>gigaflow_mapping_ctx_assign_mapping</span><span class=p>(</span><span class=n>gf_xlate_ctx</span><span class=p>,</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=p>,</span><span class=w> </span><span class=n>opt_map_out</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* 3. compose and map the wildcards as Gigaflow entries to the accel */</span>
<span class=w>    </span><span class=kt>uint64_t</span><span class=w> </span><span class=n>compose_cycles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cycles_counter_update</span><span class=p>(</span><span class=n>stats</span><span class=p>);</span>
<span class=w>    </span><span class=n>compose_gigaflows</span><span class=p>(</span><span class=n>gf_xlate_ctx</span><span class=p>,</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=p>);</span>
<span class=w>    </span><span class=n>compose_cycles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cycles_counter_update</span><span class=p>(</span><span class=n>stats</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>compose_cycles</span><span class=p>;</span>
<span class=w>    </span><span class=n>gf_perf_update_counter</span><span class=p>(</span><span class=n>gf_stats</span><span class=p>,</span><span class=w> </span><span class=n>GF_STAT_COMPOSITION_CYCLES</span><span class=p>,</span><span class=w> </span><span class=n>compose_cycles</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* 4. accept this mapping iff masks are not exceeded in any Gigaflow table */</span>
<span class=w>    </span><span class=n>accept_mapping_if_masks_within_limits</span><span class=p>(</span><span class=n>gf_map_ctx</span><span class=p>,</span><span class=w> </span><span class=n>gf_stats</span><span class=p>);</span>

<span class=w>    </span><span class=k>const</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=n>estimate_flow_space</span><span class=w> </span><span class=o>=</span><span class=w> </span>
<span class=w>        </span><span class=n>gf_map_ctx</span><span class=o>-&gt;</span><span class=n>gf_config</span><span class=o>-&gt;</span><span class=n>estimate_flow_space</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>estimate_flow_space</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=cm>/* 5. add this new mapping to our unique mappings */</span>
<span class=w>        </span><span class=n>gigaflow_state_add_new_mapping</span><span class=p>(</span><span class=n>gf_xlate_ctx</span><span class=p>,</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=p>,</span><span class=w> </span><span class=n>gf_stats</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <h3 id=exploring-sub-traversals>Exploring Sub-Traversals</h3> <p>The function <a href=https://github.com/gigaflow-vswitch/gvs/blob/asplos-25/lib/mapper.c#L794>maximize_optimality_dp</a> implements the disjoint partitioning algorithm as a dynamic program to find the optimal mapping of traversals to Gigaflow tables. It uses memoization to store intermediate results and avoid redundant calculations.</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>lib/mapper.c</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>794</span>
<span class=normal>795</span>
<span class=normal>796</span>
<span class=normal>797</span>
<span class=normal>798</span>
<span class=normal>799</span>
<span class=normal>800</span>
<span class=normal>801</span>
<span class=normal>802</span>
<span class=normal>803</span>
<span class=normal>804</span>
<span class=normal>805</span>
<span class=normal>806</span>
<span class=normal>807</span>
<span class=normal>808</span>
<span class=normal>809</span>
<span class=normal>810</span>
<span class=normal>811</span>
<span class=normal>812</span>
<span class=normal>813</span>
<span class=normal>814</span>
<span class=normal>815</span>
<span class=normal>816</span>
<span class=normal>817</span>
<span class=normal>818</span>
<span class=normal>819</span>
<span class=normal>820</span>
<span class=normal>821</span>
<span class=normal>822</span>
<span class=normal>823</span>
<span class=normal>824</span>
<span class=normal>825</span>
<span class=normal>826</span>
<span class=normal>827</span>
<span class=normal>828</span>
<span class=normal>829</span>
<span class=normal>830</span>
<span class=normal>831</span>
<span class=normal>832</span>
<span class=normal>833</span>
<span class=normal>834</span>
<span class=normal>835</span>
<span class=normal>836</span>
<span class=normal>837</span>
<span class=normal>838</span>
<span class=normal>839</span>
<span class=normal>840</span>
<span class=normal>841</span>
<span class=normal>842</span>
<span class=normal>843</span>
<span class=normal>844</span>
<span class=normal>845</span>
<span class=normal>846</span>
<span class=normal>847</span>
<span class=normal>848</span>
<span class=normal>849</span>
<span class=normal>850</span>
<span class=normal>851</span>
<span class=normal>852</span>
<span class=normal>853</span>
<span class=normal>854</span>
<span class=normal>855</span>
<span class=normal>856</span>
<span class=normal>857</span>
<span class=normal>858</span>
<span class=normal>859</span>
<span class=normal>860</span>
<span class=normal>861</span>
<span class=normal>862</span>
<span class=normal>863</span>
<span class=normal>864</span>
<span class=normal>865</span>
<span class=normal>866</span>
<span class=normal>867</span>
<span class=normal>868</span>
<span class=normal>869</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>struct</span><span class=w> </span><span class=nc>mapper_out</span><span class=o>*</span><span class=w> </span>
<span class=n>maximize_optimality_dp</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>mapper_memo</span><span class=w> </span><span class=o>*</span><span class=n>memo</span><span class=p>,</span>
<span class=w>                       </span><span class=k>struct</span><span class=w> </span><span class=nc>gigaflow_xlate_context</span><span class=w> </span><span class=o>*</span><span class=n>gf_xlate_ctx</span><span class=p>,</span>
<span class=w>                       </span><span class=k>struct</span><span class=w> </span><span class=nc>gigaflow_mapping_context</span><span class=w> </span><span class=o>*</span><span class=n>gf_map_ctx</span><span class=p>,</span>
<span class=w>                       </span><span class=kt>int</span><span class=w> </span><span class=n>t_start</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>t_end</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>g_start</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>g_end</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=cm>/* check memo before making any calls */</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>dp_memo_entry</span><span class=w> </span><span class=o>*</span><span class=n>dp_cache</span><span class=p>;</span>
<span class=w>    </span><span class=n>dp_cache</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>search_dp_memo</span><span class=p>(</span><span class=n>memo</span><span class=p>,</span><span class=w> </span><span class=n>t_start</span><span class=p>,</span><span class=w> </span><span class=n>t_end</span><span class=p>,</span><span class=w> </span><span class=n>g_start</span><span class=p>,</span><span class=w> </span><span class=n>g_end</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>dp_cache</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>dp_cache</span><span class=o>-&gt;</span><span class=n>map_out</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>mapper_out</span><span class=w> </span><span class=o>*</span><span class=n>map_out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>get_empty_mapper_out</span><span class=p>();</span>
<span class=w>    </span><span class=cm>/* base case - 1: </span>
<span class=cm>       no more traversal tables to map? */</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>t_end</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>-1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>map_out</span><span class=o>-&gt;</span><span class=n>score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>        </span><span class=c1>// nothing to map..</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>map_out</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=cm>/* base case - 2:</span>
<span class=cm>       only one Gigaflow table left?</span>
<span class=cm>       map remaining traversal tables to this Gigaflow table */</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>g_end</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=cm>/* get actual Gigaflow table ID before measuring optimality</span>
<span class=cm>           or updating a mapping on that table */</span>
<span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>gf_table_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=o>-&gt;</span><span class=n>available_tables</span><span class=p>[</span><span class=n>g_end</span><span class=p>];</span>
<span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>get_mapping_optimality</span><span class=p>(</span><span class=n>memo</span><span class=p>,</span><span class=w> </span><span class=n>gf_xlate_ctx</span><span class=p>,</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=p>,</span><span class=w> </span>
<span class=w>                                           </span><span class=n>t_start</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>t_end</span><span class=p>,</span><span class=w> </span><span class=n>t_end</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=w> </span>
<span class=w>                                           </span><span class=n>gf_table_id</span><span class=p>);</span>
<span class=w>        </span><span class=n>map_out</span><span class=o>-&gt;</span><span class=n>score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>score</span><span class=p>;</span>
<span class=w>        </span><span class=c1>// update this path mapping in mapper_out</span>
<span class=w>        </span><span class=n>mapper_out_update_mapping</span><span class=p>(</span><span class=n>map_out</span><span class=p>,</span><span class=w> </span><span class=n>t_start</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>t_end</span><span class=p>,</span><span class=w> </span><span class=n>t_end</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=w> </span>
<span class=w>                                  </span><span class=n>gf_table_id</span><span class=p>);</span>
<span class=w>        </span><span class=c1>// insert dp result into memo before returning</span>
<span class=w>        </span><span class=n>insert_into_dp_memo</span><span class=p>(</span><span class=n>memo</span><span class=p>,</span><span class=w> </span><span class=n>map_out</span><span class=p>,</span><span class=w> </span><span class=n>t_start</span><span class=p>,</span><span class=w> </span><span class=n>t_end</span><span class=p>,</span><span class=w> </span>
<span class=w>                            </span><span class=n>g_start</span><span class=p>,</span><span class=w> </span><span class=n>g_end</span><span class=p>,</span><span class=w> </span><span class=n>score</span><span class=p>);</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>map_out</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=c1>// recursive calls</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>mapper_out</span><span class=w> </span><span class=o>*</span><span class=n>dp_map_out</span><span class=p>;</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>mapped_score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>new_score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>max_score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>t_i</span><span class=o>=</span><span class=n>t_start</span><span class=p>;</span><span class=w> </span><span class=n>t_i</span><span class=o>&lt;=</span><span class=n>t_end</span><span class=p>;</span><span class=w> </span><span class=n>t_i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>dp_map_out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>maximize_optimality_dp</span><span class=p>(</span><span class=n>memo</span><span class=p>,</span><span class=w> </span><span class=n>gf_xlate_ctx</span><span class=p>,</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=p>,</span><span class=w> </span>
<span class=w>                                            </span><span class=n>t_start</span><span class=p>,</span><span class=w> </span><span class=n>t_i</span><span class=p>,</span><span class=w> </span><span class=n>g_start</span><span class=p>,</span><span class=w> </span>
<span class=w>                                            </span><span class=n>g_end</span><span class=mi>-1</span><span class=p>);</span>
<span class=w>        </span><span class=cm>/* get actual Gigaflow table ID before measuring optimality</span>
<span class=cm>           or updating a mapping on that table */</span>
<span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>gf_table_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=o>-&gt;</span><span class=n>available_tables</span><span class=p>[</span><span class=n>g_end</span><span class=p>];</span>
<span class=w>        </span><span class=n>mapped_score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>get_mapping_optimality</span><span class=p>(</span><span class=n>memo</span><span class=p>,</span><span class=w> </span><span class=n>gf_xlate_ctx</span><span class=p>,</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=p>,</span><span class=w> </span>
<span class=w>                                              </span><span class=n>t_i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>t_end</span><span class=p>,</span><span class=w> </span><span class=n>t_end</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=w> </span>
<span class=w>                                              </span><span class=n>gf_table_id</span><span class=p>);</span>
<span class=w>        </span><span class=n>new_score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dp_map_out</span><span class=o>-&gt;</span><span class=n>score</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>mapped_score</span><span class=p>;</span>
<span class=w>        </span><span class=cm>/* found a better or equally optimal solution? </span>
<span class=cm>           replace the prior mapping for this table */</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>new_score</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>max_score</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=c1>// free previous map_out and update to new best</span>
<span class=w>            </span><span class=n>mapper_out_destroy</span><span class=p>(</span><span class=n>map_out</span><span class=p>);</span>
<span class=w>            </span><span class=c1>// update this path mapping in mapper_out iff t_i+1 &lt;= t_end</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>t_i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>t_end</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=n>mapper_out_update_mapping</span><span class=p>(</span><span class=n>dp_map_out</span><span class=p>,</span><span class=w> </span><span class=n>t_i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>t_end</span><span class=p>,</span><span class=w> </span>
<span class=w>                                          </span><span class=n>t_end</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>gf_table_id</span><span class=p>);</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>            </span><span class=n>dp_map_out</span><span class=o>-&gt;</span><span class=n>score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>new_score</span><span class=p>;</span>
<span class=w>            </span><span class=n>map_out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dp_map_out</span><span class=p>;</span>
<span class=w>            </span><span class=n>max_score</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>new_score</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=c1>// this solution we tried is not any better</span>
<span class=w>            </span><span class=n>mapper_out_destroy</span><span class=p>(</span><span class=n>dp_map_out</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=c1>// insert dp result into memo before returning</span>
<span class=w>    </span><span class=n>insert_into_dp_memo</span><span class=p>(</span><span class=n>memo</span><span class=p>,</span><span class=w> </span><span class=n>map_out</span><span class=p>,</span><span class=w> </span><span class=n>t_start</span><span class=p>,</span><span class=w> </span><span class=n>t_end</span><span class=p>,</span><span class=w> </span>
<span class=w>                        </span><span class=n>g_start</span><span class=p>,</span><span class=w> </span><span class=n>g_end</span><span class=p>,</span><span class=w> </span><span class=n>max_score</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>map_out</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <h3 id=evaluating-a-sub-traversal>Evaluating a Sub-Traversal</h3> <p>The function that evaluates one sub-traversal to see if all tables overlap is called <a href=https://github.com/gigaflow-vswitch/gvs/blob/asplos-25/lib/mapper.c#L677>get_coupling</a>.</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>lib/mapper.c</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>677</span>
<span class=normal>678</span>
<span class=normal>679</span>
<span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span>
<span class=normal>686</span>
<span class=normal>687</span>
<span class=normal>688</span>
<span class=normal>689</span>
<span class=normal>690</span>
<span class=normal>691</span>
<span class=normal>692</span>
<span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span>
<span class=normal>696</span>
<span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kt>int</span><span class=w> </span>
<span class=nf>get_coupling</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>gigaflow_mapping_context</span><span class=w> </span><span class=o>*</span><span class=n>gf_map_ctx</span><span class=p>,</span>
<span class=w>             </span><span class=kt>int</span><span class=w> </span><span class=n>t_start</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>t_end</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>const</span><span class=w> </span><span class=kt>uint32_t</span><span class=w> </span><span class=n>coupling_base_score</span><span class=w> </span><span class=o>=</span><span class=w> </span>
<span class=w>        </span><span class=n>gf_map_ctx</span><span class=o>-&gt;</span><span class=n>gf_config</span><span class=o>-&gt;</span><span class=n>coupling_base_score</span><span class=p>;</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>coupling</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=c1>// just one wildcard is not a coupling</span>
<span class=w>    </span><span class=kt>uint16_t</span><span class=w> </span><span class=n>next_wc_bits</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EMPTY_WC</span><span class=p>;</span>
<span class=w>    </span><span class=kt>uint16_t</span><span class=w> </span><span class=n>curr_wc_bits</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=o>-&gt;</span><span class=n>bit_wildcards</span><span class=p>[</span><span class=n>t_start</span><span class=p>];</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=o>=</span><span class=n>t_start</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>&lt;=</span><span class=n>t_end</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>next_wc_bits</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gf_map_ctx</span><span class=o>-&gt;</span><span class=n>bit_wildcards</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
<span class=w>        </span><span class=cm>/* if either of current or next are empty wildcards OR </span>
<span class=cm>           if not, have common bits, subsume into current and move on */</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=n>curr_wc_bits</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>EMPTY_WC</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>next_wc_bits</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>EMPTY_WC</span><span class=p>)</span>
<span class=w>            </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>curr_wc_bits</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>next_wc_bits</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>curr_wc_bits</span><span class=w> </span><span class=o>|=</span><span class=w> </span><span class=n>next_wc_bits</span><span class=p>;</span>
<span class=w>            </span><span class=n>coupling</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>coupling_base_score</span><span class=p>;</span><span class=w> </span><span class=c1>// better coupling</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=cm>/* found decoupling within this range; bad combination */</span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>coupling</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <h3 id=putting-it-all-together>Putting It All Together</h3> <p>For a given traversal, our disjoint partitioning algorithm tries all sub-traversal combinations and evaluates them for disjointedness using the <a href=#evaluating-a-sub-traversal>get_coupling</a> function. The sub-traversal combination with maximum sum of disjointedness is selected for mapping to the Gigaflow tables.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../benchmarks/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Benchmarks"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Benchmarks </div> </div> </a> <a href=../contributing/ class="md-footer__link md-footer__link--next" aria-label="Next: Contributing"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Contributing </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 NextGArch Lab, University of Michigan </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://dl.acm.org/doi/10.1145/3676641.3716000 target=_blank rel=noopener title=dl.acm.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0h160v128c0 17.7 14.3 32 32 32h128v144H176c-35.3 0-64 28.7-64 64v144H64c-35.3 0-64-28.7-64-64zm384 64H256V0zM176 352h32c30.9 0 56 25.1 56 56s-25.1 56-56 56h-16v32c0 8.8-7.2 16-16 16s-16-7.2-16-16V368c0-8.8 7.2-16 16-16m32 80c13.3 0 24-10.7 24-24s-10.7-24-24-24h-16v48zm96-80h32c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48h-32c-8.8 0-16-7.2-16-16V368c0-8.8 7.2-16 16-16m32 128c8.8 0 16-7.2 16-16v-64c0-8.8-7.2-16-16-16h-16v96zm80-112c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v32h32c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v48c0 8.8-7.2 16-16 16s-16-7.2-16-16V368"/></svg> </a> <a href=https://github.com/gigaflow-vswitch target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.linkedin.com/in/annuszulfiqar/ target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://gitlab.com/mshahbaz/mshahbaz.gitlab.io/-/wikis/home target=_blank rel=noopener title=gitlab.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81s-5.7.083-8.4 1.11c-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.1 18.1 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.tabs", "navigation.top", "navigation.footer", "navigation.tabs.sticky", "content.tooltips", "search.suggest", "search.highlight", "toc.integrate", "content.code.copy", "dark_mode"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.c8b220af.min.js></script> </body> </html>